<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fandom Wiki Timeline Builder</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-6 md:p-12">
    <div class="max-w-6xl mx-auto bg-white p-8 rounded-xl shadow-lg">
        <h1 class="text-3xl font-bold mb-2 text-center text-gray-800">Fandom Wiki Timeline Builder</h1>
        <p class="text-center text-gray-600 mb-8">Build your story's timeline and generate wikitext to paste on your wiki.</p>

        <!-- Builder Form -->
        <div class="space-y-6">
            <div>
                <label for="timeline-title" class="block text-sm font-medium text-gray-700">Timeline Title</label>
                <input type="text" id="timeline-title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500" placeholder="e.g., The Journey of the Heroes">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="start-date" class="block text-sm font-medium text-gray-700">Start Date (e.g., -200, 1500, or YYYY-MM-DD)</label>
                    <input type="text" id="start-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500" placeholder="e.g., -200">
                </div>
                <div>
                    <label for="end-date" class="block text-sm font-medium text-gray-700">End Date (e.g., 500, 2024, or YYYY-MM-DD)</label>
                    <input type="text" id="end-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500" placeholder="e.g., 500">
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="minor-increment" class="block text-sm font-medium text-gray-700">Minor Ticks Increment</label>
                    <input type="number" id="minor-increment" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500" placeholder="e.g., 10">
                </div>
                <div>
                    <label for="major-increment" class="block text-sm font-medium text-gray-700">Major Ticks Increment (label displayed)</label>
                    <input type="number" id="major-increment" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500" placeholder="e.g., 50">
                </div>
            </div>

            <div id="events-list" class="space-y-4">
                <!-- Dynamic events will be added here -->
            </div>

            <button id="add-event-btn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                Add New Event
            </button>
        </div>

        <!-- Preview Section -->
        <div class="mt-12">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Live Preview</h2>
            <div id="timeline-preview" class="timeline-container bg-gray-100 rounded-lg shadow-inner">
                <div class="timeline-line-extended"></div>
            </div>
        </div>

        <!-- Wikitext Output -->
        <div class="mt-12">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Generated Wikitext</h2>
            <p class="text-gray-600 mb-4">Copy this code and paste it into your wiki page. You will need to create a `Template:Timeline` with the provided code below for it to work.</p>
            <textarea id="wikitext-output" class="w-full h-64 p-4 text-sm font-mono bg-gray-100 border border-gray-300 rounded-md shadow-inner" readonly></textarea>
            <button id="copy-btn" class="mt-4 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                Copy Wikitext
            </button>
        </div>

        <!-- Template Information -->
        <div class="mt-12 p-6 bg-blue-50 rounded-lg shadow-sm">
            <h3 class="text-xl font-bold mb-2 text-blue-800">Required Wiki Template</h3>
            <p class="text-sm text-blue-700 mb-4">Create a new page on your wiki named <code class="font-mono bg-blue-100 p-1 rounded">Template:Timeline</code> and paste this code into it. This template will process the data generated by this tool.</p>
            <pre class="w-full bg-gray-800 text-white p-4 rounded-md overflow-x-auto text-sm font-mono">
<code id="template-code">
&lt;!-- Template:Timeline --&gt;
&lt;div class="timeline-container" style="position:relative; min-height: 350px; padding: 4rem 1rem 3rem;"&gt;
    &lt;div style="position:absolute; bottom:-4px; left:0; right:0; height:4px; background:#9ca3af;"&gt;&lt;/div&gt;
    {{#invoke:timeline|render|data={{{1|}}}}}
&lt;/div&gt;
</code>
            </pre>
            <p class="text-sm text-blue-700 mt-4">
                <span class="font-bold">Note:</span> This template requires the <code class="font-mono bg-blue-100 p-1 rounded">Module:Timeline</code> to be created, which processes the JSON data. A module is a page in the <code class="font-mono bg-blue-100 p-1 rounded">Module:</code> namespace. This simplified Lua script shows how the data can be received. A production-ready module would need advanced features like date format parsing, automatic vertical stacking of events to avoid collision, and the rendering of tick marks.
            </p>
            <pre class="w-full bg-gray-800 text-white p-4 rounded-md mt-2 overflow-x-auto text-sm font-mono">
<code id="lua-code">
local p = {}

function p.render(frame)
    local args = frame.args
    local data_string = args.data
    local data = mw.text.jsonDecode(data_string)
    local html = ""
    local start_date = data.start_date
    local end_date = data.end_date

    local function get_position(event_date)
        local total_range = end_date - start_date
        if total_range == 0 then return 50 end
        local event_position = (event_date - start_date) / total_range * 100
        return math.max(0, math.min(100, event_position))
    end

    for _, event in ipairs(data.events) do
        local position = get_position(tonumber(event.date))
        local transform_y = "-50%"

        html = html .. '&lt;div class="timeline-event" style="left:' .. position .. '%; top: 50%; transform:translateY(' .. transform_y .. ');"&gt;'
        html = html .. '&lt;div class="event-dot"&gt;&lt;/div&gt;'
        html = html .. '&lt;div class="event-label"&gt;' .. event.label .. '&lt;br&gt;&lt;small&gt;' .. event.date_label .. '&lt;/small&gt;&lt;/div&gt;'
        html = html .. '&lt;/div&gt;'
    end

    return html
end

return p
</code>
            </pre>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>
